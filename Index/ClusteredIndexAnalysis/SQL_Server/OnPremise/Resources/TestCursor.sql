/*Clustered STJ0
1er enregistrement:      AE011;2;BMS104;04/02/2021;99999999;0
Dernier enregistrement:  ZA021;2;RAW303;11/04/2021;99999999;0
Enregistrement milieu:   NA012;2;RAW907;25/09/2021;99999999;0
Index fragmentation 0,08%*/

/*HEAP
#1er enregistrement:      AE011;2;BMS104;04/02/2021;99999999;0
#Dernier enregistrement:  ZA021;2;RAW303;11/04/2021;99999999;0
#Enregistrement 15200:    PT021;2;RAW308;02/03/2021;99999999;0
#Index fragmentation 0%*/

-- Insert equivalent to a write in 4GL
SET STATISTICS IO ON;
SET STATISTICS TIME ON;
INSERT INTO SEED.STOJOU (
	UPDTICK_0
	,STOFCY_0
	,UPDCOD_0
	,ITMREF_0
	,IPTDAT_0
	,MVTSEQ_0
	,MVTIND_0
	,CSTDAT_0
	,CSTTIM_0
	,CSTCOU_0
	,OWNER_0
	,LOT_0
	,SLO_0
	,BPSLOT_0
	,LOC_0
	,WRH_0
	,SERNUM_0
	,TRSTYP_0
	,TRSFAM_0
	,MVTDES_0
	,PJT_0
	,BPRNUM_0
	,VCRTYP_0
	,VCRNUM_0
	,VCRLIN_0
	,VCRTYPORI_0
	,VCRNUMORI_0
	,VCRLINORI_0
	,VCRSEQORI_0
	,VCRTYPREG_0
	,VCRNUMREG_0
	,VCRLINREG_0
	,USRFLD1_0
	,USRFLD2_0
	,USRFLD3_0
	,USRFLD4_0
	,PCU_0
	,QTYPCU_0
	,PCUSTUCOE_0
	,QTYSTU_0
	,STU_0
	,PCUORI_0
	,PCUSTUORI_0
	,AMTORD_0
	,AMTVAL_0
	,VARORD_0
	,VARVAL_0
	,PRIORD_0
	,PRIVAL_0
	,PRINAT_0
	,AMTVAL2_0
	,VARVAL2_0
	,PRIVAL2_0
	,PRINAT2_0
	,PRIREGFLG_0
	,AMTDEV_0
	,AMTDEV2_0
	,SHLDAT_0
	,STA_0
	,POT_0
	,ACT_0
	,ACTQTY_0
	,QLYCTLDEM_0
	,PRNFLG_0
	,REGFLG_0
	,LBEFMT_0
	,LBENBR_0
	,DIE_0
	,DIE_1
	,DIE_2
	,DIE_3
	,DIE_4
	,DIE_5
	,DIE_6
	,DIE_7
	,DIE_8
	,DIE_9
	,DIE_10
	,DIE_11
	,DIE_12
	,DIE_13
	,DIE_14
	,DIE_15
	,DIE_16
	,DIE_17
	,DIE_18
	,DIE_19
	,CCE_0
	,CCE_1
	,CCE_2
	,CCE_3
	,CCE_4
	,CCE_5
	,CCE_6
	,CCE_7
	,CCE_8
	,CCE_9
	,CCE_10
	,CCE_11
	,CCE_12
	,CCE_13
	,CCE_14
	,CCE_15
	,CCE_16
	,CCE_17
	,CCE_18
	,CCE_19
	,ENTCOD_0
	,FINRSPFCY_0
	,AGGIFAFLG_0
	,GTE_0
	,NUMVCR_0
	,PITVALFLG_0
	,PITVALFLG2_0
	,PALNUM_0
	,CTRNUM_0
	,BETCPY_0
	,DLUDAT_0
	,NEWLTIDAT_0
	,CREMVTDAT_0
	,CREMVTTIM_0
	,CREMVTSEQ_0
	,EXPNUM_0
	,PRONUM_0
	,CREDAT_0
	,CRETIM_0
	,CREUSR_0
	,UPDDAT_0
	,UPDUSR_0
	,CREDATTIM_0
	,UPDDATTIM_0
	,AUUID_0
	,ACCDAT_0
	,ECCVALMAJ_0
	,ECCVALMIN_0
	,SERDEB_0
	,STOFLD1_0
	,SERFIN_0
	,STOFLD2_0
	,LPNNUM_0
	)
VALUES (
	1
	,N'NA012'
	,2
	,N'INSERT01'
	,'2021-09-25 00:00:00'
	,99999999
	,0
	,'2021-08-18 00:00:00'
	,N'204215'
	,4357.0
	,N'NA012'
	,N' '
	,N' '
	,N' '
	,N'TNK04'
	,N' '
	,N' '
	,6
	,N' '
	,N' '
	,N' '
	,N' '
	,12
	,N'WOTNA0120102'
	,2
	,10
	,N'WONA0120103'
	,1000
	,10
	,0
	,N' '
	,0
	,N' '
	,N' '
	,0.0
	,'1753-01-01 00:00:00'
	,N'GL'
	,- 216.0000000000000
	,1.0000000
	,- 216.0000000000000
	,N'GL'
	,N'GL'
	,1.0000000
	,- 3270.3480000000000
	,- 3270.3480000000000
	,- 3270.3480000000000
	,- 3270.3480000000000
	,15.1405000000000
	,15.1405000000000
	,2
	,- 3216.8232000000000
	,- 3216.8232000000000
	,14.8927000000000
	,5
	,1
	,0
	,- 53.5248000000000
	,'2999-12-31 00:00:00'
	,N'A'
	,100.00000
	,1.00000
	,- 216.0000000000000
	,N' '
	,0
	,1
	,N' '
	,0
	,N'CCT'
	,N'MAR'
	,N'PRO'
	,N'PRJ'
	,N'ENV'
	,N'ENT'
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N'913'
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N'NA012'
	,2
	,N' '
	,N' '
	,2
	,2
	,N' '
	,N' '
	,1
	,'2999-12-31 00:00:00'
	,'2999-12-31 00:00:00'
	,'2022-03-15 00:00:00'
	,N'235742'
	,12148
	,3
	,0
	,'2022-03-15 00:00:00'
	,N'2357'
	,N'XCC'
	,'1753-01-01 00:00:00'
	,N'ADMIN'
	,'2021-07-13 15:58:26'
	,'2021-07-13 15:58:26'
	,0x2CC8DBC89C28324B920DA03C38A9FF24
	,'1753-01-01 00:00:00'
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	)
SET STATISTICS TIME Off;
SET STATISTICS IO OFF;

-- SELECT with cursors, équivalent to Read and For loop in 4GL.
-- Then there are variants depending on if it is a read first, last, or on key
declare @STOFCY nvarchar(5)
		,@UPDCOD int
		,@ITMREF nvarchar(50)
		,@IPTDAT datetime
		,@MVTSEQ int
		,@MVTIND int

SET @STOFCY='NA012'
SET @UPDCOD=2
SET @ITMREF='INSERT01'
SET @IPTDAT='2021-09-25 00:00:00'
SET @MVTSEQ=99999999
SET @MVTIND=0

DECLARE READ_STJ CURSOR fast_forward
FOR 
	select STJ.ROWID
	, STJ.*
	from  SEED.STOJOU STJ 
	where STJ.STOFCY_0=@STOFCY
	and STJ.UPDCOD_0=2
	and STJ.ITMREF_0=@ITMREF
	and STJ.IPTDAT_0=@IPTDAT
	and STJ.MVTSEQ_0=@MVTSEQ
	and STJ.MVTIND_0=@MVTIND
	--Read first
	--ORDER BY STJ.STOFCY_0, STJ.UPDCOD_0, STJ.ITMREF_0, STJ.IPTDAT_0 Desc, STJ.MVTSEQ_0, STJ.MVTIND_0
	-- Read Last
	Order by STJ.STOFCY_0 Desc, STJ.UPDCOD_0 Desc, STJ.ITMREF_0 Desc, STJ.IPTDAT_0, STJ.MVTSEQ_0 Desc, STJ.MVTIND_0 Desc
	Option (FAST 1)

OPEN READ_STJ

SET STATISTICS IO ON;
SET STATISTICS TIME ON;

FETCH NEXT FROM READ_STJ ;

SET STATISTICS TIME OFF;
SET STATISTICS IO OFF;

--WHILE @@FETCH_STATUS = 0
--BEGIN
--	FETCH NEXT FROM READ_STJ;
--END

CLOSE READ_STJ;
DEALLOCATE READ_STJ;

-- extract the ROWID value

-- Update on rowid, equivalent to an update where in 4GL
SET STATISTICS IO ON;
SET STATISTICS TIME ON;
GO;
Update SEED.STOJOU
set AGGIFAFLG_0=2
Where SEED.STOJOU.ROWID=30445; 
GO 10000

SET STATISTICS TIME OFF;
SET STATISTICS IO OFF;

-- Update on rowid - equivalent to a rewrite where in 4GL
SET STATISTICS IO ON;
SET STATISTICS TIME ON;
Update SEED.STOJOU set
SEED.STOJOU.STOFCY_0=N'NA012',SEED.STOJOU.UPDCOD_0=2,SEED.STOJOU.ITMREF_0=N'INSERT01',SEED.STOJOU.IPTDAT_0='2021-09-25 00:00:00',SEED.STOJOU.MVTSEQ_0=99999999,SEED.STOJOU.MVTIND_0=0,SEED.STOJOU.CSTDAT_0='2021-08-18 00:00:00'
,SEED.STOJOU.CSTTIM_0=N'204215',SEED.STOJOU.CSTCOU_0=4357.0
,SEED.STOJOU.OWNER_0=N'NA012',SEED.STOJOU.LOT_0=N' ',SEED.STOJOU.SLO_0=N' ',SEED.STOJOU.BPSLOT_0=N' ',SEED.STOJOU.LOC_0=N'TNK04',SEED.STOJOU.WRH_0=N' ',SEED.STOJOU.SERNUM_0=N' ',SEED.STOJOU.TRSTYP_0=6,SEED.STOJOU.TRSFAM_0=N' '
,SEED.STOJOU.MVTDES_0=N' ',SEED.STOJOU.PJT_0=N' ',SEED.STOJOU.BPRNUM_0=N' ',SEED.STOJOU.VCRTYP_0=12,SEED.STOJOU.VCRNUM_0=N'WOTNA0120102',SEED.STOJOU.VCRLIN_0=2,SEED.STOJOU.VCRTYPORI_0=10,SEED.STOJOU.VCRNUMORI_0=N'WONA0120103'
,SEED.STOJOU.VCRLINORI_0=1000
,SEED.STOJOU.VCRSEQORI_0=10
,SEED.STOJOU.VCRTYPREG_0=0
,SEED.STOJOU.VCRNUMREG_0=N' '
,SEED.STOJOU.VCRLINREG_0=0
,SEED.STOJOU.USRFLD1_0=N' ',SEED.STOJOU.USRFLD2_0=N' ',SEED.STOJOU.USRFLD3_0=0.0,SEED.STOJOU.USRFLD4_0='1753-01-01 00:00:00'
,SEED.STOJOU.PCU_0=N'GL',SEED.STOJOU.QTYPCU_0=-216.0000000000000,SEED.STOJOU.PCUSTUCOE_0=1.0000000,SEED.STOJOU.QTYSTU_0=-216.0000000000000,SEED.STOJOU.STU_0=N'GL',SEED.STOJOU.PCUORI_0=N'GL'
,SEED.STOJOU.PCUSTUORI_0=1.0000000,SEED.STOJOU.AMTORD_0=-3270.3480000000000,SEED.STOJOU.AMTVAL_0=-3270.3480000000000,SEED.STOJOU.VARORD_0=-3270.3480000000000,SEED.STOJOU.VARVAL_0=-3270.3480000000000
,SEED.STOJOU.PRIORD_0=15.1405000000000,SEED.STOJOU.PRIVAL_0=15.1405000000000,SEED.STOJOU.PRINAT_0=2
,SEED.STOJOU.AMTVAL2_0=-3216.8232000000000,SEED.STOJOU.VARVAL2_0=-3216.8232000000000,SEED.STOJOU.PRIVAL2_0=14.8927000000000,SEED.STOJOU.PRINAT2_0=5,SEED.STOJOU.PRIREGFLG_0=1
,SEED.STOJOU.AMTDEV_0=0,SEED.STOJOU.AMTDEV2_0=-53.5248000000000,SEED.STOJOU.SHLDAT_0='2999-12-31 00:00:00'
,SEED.STOJOU.STA_0=N'A',SEED.STOJOU.POT_0=100.00000,SEED.STOJOU.ACT_0=1.00000,SEED.STOJOU.ACTQTY_0=-216.0000000000000,SEED.STOJOU.QLYCTLDEM_0=N' ',SEED.STOJOU.PRNFLG_0=0,SEED.STOJOU.REGFLG_0=1
,SEED.STOJOU.LBEFMT_0=N' ',SEED.STOJOU.LBENBR_0=0
,SEED.STOJOU.DIE_0=N'CCT',SEED.STOJOU.DIE_1=N'MAR',SEED.STOJOU.DIE_2=N'PRO',SEED.STOJOU.DIE_3=N'PRJ',SEED.STOJOU.DIE_4=N'ENV',SEED.STOJOU.DIE_5=N'ENT',SEED.STOJOU.DIE_6=N' ',SEED.STOJOU.DIE_7=N' ',SEED.STOJOU.DIE_8=N' '
,SEED.STOJOU.DIE_9=N' ',SEED.STOJOU.DIE_10=N' ',SEED.STOJOU.DIE_11=N' ',SEED.STOJOU.DIE_12=N' ',SEED.STOJOU.DIE_13=N' ',SEED.STOJOU.DIE_14=N' ',SEED.STOJOU.DIE_15=N' ',SEED.STOJOU.DIE_16=N' ',SEED.STOJOU.DIE_17=N' '
,SEED.STOJOU.DIE_18=N' ',SEED.STOJOU.DIE_19=N' ',SEED.STOJOU.CCE_0=N' ',SEED.STOJOU.CCE_1=N' ',SEED.STOJOU.CCE_2=N'913',SEED.STOJOU.CCE_3=N' ',SEED.STOJOU.CCE_4=N' ',SEED.STOJOU.CCE_5=N' ',SEED.STOJOU.CCE_6=N' '
,SEED.STOJOU.CCE_7=N' ',SEED.STOJOU.CCE_8=N' ',SEED.STOJOU.CCE_9=N' ',SEED.STOJOU.CCE_10=N' ',SEED.STOJOU.CCE_11=N' ',SEED.STOJOU.CCE_12=N' ',SEED.STOJOU.CCE_13=N' ',SEED.STOJOU.CCE_14=N' ',SEED.STOJOU.CCE_15=N' '
,SEED.STOJOU.CCE_16=N' ',SEED.STOJOU.CCE_17=N' ',SEED.STOJOU.CCE_18=N' ',SEED.STOJOU.CCE_19=N' ',SEED.STOJOU.ENTCOD_0=N' ',SEED.STOJOU.FINRSPFCY_0=N'NA012',SEED.STOJOU.AGGIFAFLG_0=2,SEED.STOJOU.GTE_0=N' '
,SEED.STOJOU.NUMVCR_0=N' ',SEED.STOJOU.PITVALFLG_0=2,SEED.STOJOU.PITVALFLG2_0=2,SEED.STOJOU.PALNUM_0=N' ',SEED.STOJOU.CTRNUM_0=N' ',SEED.STOJOU.BETCPY_0=1,SEED.STOJOU.DLUDAT_0='2999-12-31 00:00:00'
,SEED.STOJOU.NEWLTIDAT_0='2999-12-31 00:00:00'
,SEED.STOJOU.CREMVTDAT_0='2022-03-15 00:00:00',SEED.STOJOU.CREMVTTIM_0=N'235742',SEED.STOJOU.CREMVTSEQ_0=12148,SEED.STOJOU.EXPNUM_0=3,SEED.STOJOU.PRONUM_0=0,SEED.STOJOU.CREDAT_0='2022-03-15 00:00:00'
,SEED.STOJOU.CRETIM_0=N'2357',SEED.STOJOU.CREUSR_0=N'XCC'
,SEED.STOJOU.UPDDAT_0='1753-01-01 00:00:00',SEED.STOJOU.UPDUSR_0=N'ADMIN',SEED.STOJOU.CREDATTIM_0='2021-07-13 15:58:26',SEED.STOJOU.UPDDATTIM_0='2021-07-16 13:04:30',SEED.STOJOU.AUUID_0=0x2CC8DBC89C28324B920DA03C38A9FF24
,SEED.STOJOU.ACCDAT_0='1753-01-01 00:00:00'
,SEED.STOJOU.ECCVALMAJ_0=N' ',SEED.STOJOU.ECCVALMIN_0=N' '
,SEED.STOJOU.SERDEB_0=N' ',SEED.STOJOU.STOFLD1_0=N' ',SEED.STOJOU.SERFIN_0=N' ',SEED.STOJOU.STOFLD2_0=N' ',SEED.STOJOU.LPNNUM_0=N' '
Where SEED.STOJOU.ROWID = 30445;
 
SET STATISTICS TIME OFF;
SET STATISTICS IO OFF;

SET STATISTICS IO ON;
SET STATISTICS TIME ON;
-- Update on key - equivalent to an update where in 4GL
UPDATE SEED.STOJOU SET SEED.STOJOU.UPDUSR_0 =  N'ADMIN',
SEED.STOJOU.UPDDATTIM_0 =  '2021-07-16 14:08:00',
SEED.STOJOU.AGGIFAFLG_0 =  2
Where SEED.STOJOU.STOFCY_0 = N'NA012' And SEED.STOJOU.UPDCOD_0 = 2 And SEED.STOJOU.ITMREF_0 = N'INSERT01' And SEED.STOJOU.IPTDAT_0 = '2021-09-25 00:00:00' 
And SEED.STOJOU.MVTSEQ_0 = 99999999 And SEED.STOJOU.MVTIND_0 = 0

SET STATISTICS TIME OFF;
SET STATISTICS IO OFF;



-- Delete on KEY - equivalent to a delete where in 4GL
SET STATISTICS IO ON;
SET STATISTICS TIME ON;
DELETE FROM SEED.STOJOU
Where SEED.STOJOU.STOFCY_0 = N'NA012' And SEED.STOJOU.UPDCOD_0 = 2 And SEED.STOJOU.ITMREF_0 = N'INSERT01' And SEED.STOJOU.IPTDAT_0 = '2021-09-25 00:00:00' And SEED.STOJOU.MVTSEQ_0 = 99999999 And SEED.STOJOU.MVTIND_0 = 0
SET STATISTICS TIME OFF;
SET STATISTICS IO OFF;

-- Insert equivalent to a write in 4GL
SET STATISTICS IO ON;
SET STATISTICS TIME ON;
INSERT INTO SEED.STOJOU (
	UPDTICK_0
	,STOFCY_0
	,UPDCOD_0
	,ITMREF_0
	,IPTDAT_0
	,MVTSEQ_0
	,MVTIND_0
	,CSTDAT_0
	,CSTTIM_0
	,CSTCOU_0
	,OWNER_0
	,LOT_0
	,SLO_0
	,BPSLOT_0
	,LOC_0
	,WRH_0
	,SERNUM_0
	,TRSTYP_0
	,TRSFAM_0
	,MVTDES_0
	,PJT_0
	,BPRNUM_0
	,VCRTYP_0
	,VCRNUM_0
	,VCRLIN_0
	,VCRTYPORI_0
	,VCRNUMORI_0
	,VCRLINORI_0
	,VCRSEQORI_0
	,VCRTYPREG_0
	,VCRNUMREG_0
	,VCRLINREG_0
	,USRFLD1_0
	,USRFLD2_0
	,USRFLD3_0
	,USRFLD4_0
	,PCU_0
	,QTYPCU_0
	,PCUSTUCOE_0
	,QTYSTU_0
	,STU_0
	,PCUORI_0
	,PCUSTUORI_0
	,AMTORD_0
	,AMTVAL_0
	,VARORD_0
	,VARVAL_0
	,PRIORD_0
	,PRIVAL_0
	,PRINAT_0
	,AMTVAL2_0
	,VARVAL2_0
	,PRIVAL2_0
	,PRINAT2_0
	,PRIREGFLG_0
	,AMTDEV_0
	,AMTDEV2_0
	,SHLDAT_0
	,STA_0
	,POT_0
	,ACT_0
	,ACTQTY_0
	,QLYCTLDEM_0
	,PRNFLG_0
	,REGFLG_0
	,LBEFMT_0
	,LBENBR_0
	,DIE_0
	,DIE_1
	,DIE_2
	,DIE_3
	,DIE_4
	,DIE_5
	,DIE_6
	,DIE_7
	,DIE_8
	,DIE_9
	,DIE_10
	,DIE_11
	,DIE_12
	,DIE_13
	,DIE_14
	,DIE_15
	,DIE_16
	,DIE_17
	,DIE_18
	,DIE_19
	,CCE_0
	,CCE_1
	,CCE_2
	,CCE_3
	,CCE_4
	,CCE_5
	,CCE_6
	,CCE_7
	,CCE_8
	,CCE_9
	,CCE_10
	,CCE_11
	,CCE_12
	,CCE_13
	,CCE_14
	,CCE_15
	,CCE_16
	,CCE_17
	,CCE_18
	,CCE_19
	,ENTCOD_0
	,FINRSPFCY_0
	,AGGIFAFLG_0
	,GTE_0
	,NUMVCR_0
	,PITVALFLG_0
	,PITVALFLG2_0
	,PALNUM_0
	,CTRNUM_0
	,BETCPY_0
	,DLUDAT_0
	,NEWLTIDAT_0
	,CREMVTDAT_0
	,CREMVTTIM_0
	,CREMVTSEQ_0
	,EXPNUM_0
	,PRONUM_0
	,CREDAT_0
	,CRETIM_0
	,CREUSR_0
	,UPDDAT_0
	,UPDUSR_0
	,CREDATTIM_0
	,UPDDATTIM_0
	,AUUID_0
	,ACCDAT_0
	,ECCVALMAJ_0
	,ECCVALMIN_0
	,SERDEB_0
	,STOFLD1_0
	,SERFIN_0
	,STOFLD2_0
	,LPNNUM_0
	)
VALUES (
	1
	,N'NA012'
	,2
	,N'INSERT01'
	,'2021-09-25 00:00:00'
	,99999999
	,0
	,'2021-08-18 00:00:00'
	,N'204215'
	,4357.0
	,N'NA012'
	,N' '
	,N' '
	,N' '
	,N'TNK04'
	,N' '
	,N' '
	,6
	,N' '
	,N' '
	,N' '
	,N' '
	,12
	,N'WOTNA0120102'
	,2
	,10
	,N'WONA0120103'
	,1000
	,10
	,0
	,N' '
	,0
	,N' '
	,N' '
	,0.0
	,'1753-01-01 00:00:00'
	,N'GL'
	,- 216.0000000000000
	,1.0000000
	,- 216.0000000000000
	,N'GL'
	,N'GL'
	,1.0000000
	,- 3270.3480000000000
	,- 3270.3480000000000
	,- 3270.3480000000000
	,- 3270.3480000000000
	,15.1405000000000
	,15.1405000000000
	,2
	,- 3216.8232000000000
	,- 3216.8232000000000
	,14.8927000000000
	,5
	,1
	,0
	,- 53.5248000000000
	,'2999-12-31 00:00:00'
	,N'A'
	,100.00000
	,1.00000
	,- 216.0000000000000
	,N' '
	,0
	,1
	,N' '
	,0
	,N'CCT'
	,N'MAR'
	,N'PRO'
	,N'PRJ'
	,N'ENV'
	,N'ENT'
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N'913'
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N'NA012'
	,2
	,N' '
	,N' '
	,2
	,2
	,N' '
	,N' '
	,1
	,'2999-12-31 00:00:00'
	,'2999-12-31 00:00:00'
	,'2022-03-15 00:00:00'
	,N'235742'
	,12148
	,3
	,0
	,'2022-03-15 00:00:00'
	,N'2357'
	,N'XCC'
	,'1753-01-01 00:00:00'
	,N'ADMIN'
	,'2021-07-13 15:58:26'
	,'2021-07-13 15:58:26'
	,0x2CC8DBC89C28324B920DA03C38A9FF24
	,'1753-01-01 00:00:00'
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	,N' '
	)
SET STATISTICS TIME Off;
SET STATISTICS IO OFF;

-- SELECT with cursors, équivalent to Read and For loop in 4GL.

SET @STOFCY='NA012'
SET @UPDCOD=2
SET @ITMREF='INSERT01'
SET @IPTDAT='2021-09-25 00:00:00'
SET @MVTSEQ=99999999
SET @MVTIND=0

DECLARE READ_STJ CURSOR fast_forward
FOR 
	select STJ.ROWID
	, STJ.*
	from  SEED.STOJOU STJ 
	where STJ.STOFCY_0=@STOFCY
	and STJ.UPDCOD_0=2
	and STJ.ITMREF_0=@ITMREF
	and STJ.IPTDAT_0=@IPTDAT
	and STJ.MVTSEQ_0=@MVTSEQ
	and STJ.MVTIND_0=@MVTIND
	--Read first
	--ORDER BY STJ.STOFCY_0, STJ.UPDCOD_0, STJ.ITMREF_0, STJ.IPTDAT_0 Desc, STJ.MVTSEQ_0, STJ.MVTIND_0
	-- Read Last
	Order by STJ.STOFCY_0 Desc, STJ.UPDCOD_0 Desc, STJ.ITMREF_0 Desc, STJ.IPTDAT_0, STJ.MVTSEQ_0 Desc, STJ.MVTIND_0 Desc
	Option (FAST 1)

OPEN READ_STJ

SET STATISTICS IO ON;
SET STATISTICS TIME ON;

FETCH NEXT FROM READ_STJ ;

SET STATISTICS TIME OFF;
SET STATISTICS IO OFF;

--WHILE @@FETCH_STATUS = 0
--BEGIN
--	FETCH NEXT FROM READ_STJ;
--END

CLOSE READ_STJ;
DEALLOCATE READ_STJ;

-- get ROWID value

--Delete on ROWID - Equivalent to a read + Delete curr in 4GL
SET STATISTICS IO ON;
SET STATISTICS TIME ON;
DELETE FROM SEED.STOJOU
Where SEED.STOJOU.ROWID=30443
SET STATISTICS TIME OFF;
SET STATISTICS IO OFF;


--Update 2447 records from index
SET STATISTICS IO ON;
SET STATISTICS TIME ON;

UPDATE SEED.STOJOU SET SEED.STOJOU.UPDUSR_0 =  N'ADMIN',
SEED.STOJOU.UPDDATTIM_0 =  '2021-07-16 14:08:00',
SEED.STOJOU.AGGIFAFLG_0 =  2
Where SEED.STOJOU.STOFCY_0 = N'NA012'

SET STATISTICS TIME OFF;
SET STATISTICS IO OFF;

-- Update all records nout using indexes
SET STATISTICS IO ON;
SET STATISTICS TIME ON;

UPDATE SEED.STOJOU SET SEED.STOJOU.UPDUSR_0 =  N'ADMIN',
SEED.STOJOU.UPDDATTIM_0 =  '2021-07-16 14:08:00',
SEED.STOJOU.AGGIFAFLG_0 =  1
Where SEED.STOJOU.AGGIFAFLG_0 = 2

SET STATISTICS TIME OFF;
SET STATISTICS IO OFF;

